<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iTabs for GoFundMe - Make Your Campaign Stand Out</title>

    <!-- CHANGE THESE FOR YOUR LINK PREVIEW -->
    <meta property="og:title" content="iTabs for GoFundMe - Make Your Campaign Stand Out">
    <meta property="og:description" content="Turn your fundraiser into a visual story people actually read. Free tool - try it now.">
    <meta property="og:image" content="https://i.ibb.co/CHANGE-THIS/your-preview-image.jpg">
    <meta property="og:url" content="https://YOUR-DOMAIN.com/itabs-gofundme">
    <meta property="og:type" content="website">

    <!-- Twitter/X card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="iTabs for GoFundMe - Make Your Campaign Stand Out">
    <meta name="twitter:description" content="Turn your fundraiser into a visual story people actually read. Free tool - try it now.">
    <meta name="twitter:image" content="https://i.ibb.co/CHANGE-THIS/your-preview-image.jpg">

    <!-- General description for search engines -->
    <meta name="description" content="Make your GoFundMe campaign impossible to ignore. iTabs turns your story into a visual, interactive experience that builds trust and drives donations.">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
            padding: 15px;
            padding-bottom: 50px;
        }
        
        .page-header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .page-header h1 {
            color: #05CE78;
            font-size: 1.8em;
            margin-bottom: 5px;
        }
        
        .page-header p {
            color: #666;
            font-size: 1em;
        }
        
        /* The iTabs Card */
        .card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.12);
            max-width: 420px;
            margin: 0 auto 25px;
        }
        
        .slideshow-container {
            position: relative;
            width: 100%;
            height: 280px;
            background: linear-gradient(135deg, #05CE78 0%, #00A862 100%);
            overflow: hidden;
        }
        
        .slides-track {
            display: flex;
            height: 100%;
            transition: transform 0.4s ease;
        }
        
        .slide {
            min-width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #05CE78 0%, #00A862 100%);
            position: relative;
        }
        
        .slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .slide .placeholder-content {
            text-align: center;
            color: white;
        }
        
        .slide .placeholder-content .num {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.25);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            margin: 0 auto 10px;
        }
        
        .slide .placeholder-content p {
            opacity: 0.9;
            font-size: 0.95em;
        }
        
        /* Navigation dots */
        .dots-container {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        
        .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid white;
        }
        
        .dot.active {
            background: white;
            transform: scale(1.2);
        }
        
        /* i button */
        .i-button {
            position: absolute;
            bottom: 15px;
            right: 15px;
            width: 50px;
            height: 50px;
            background: white;
            color: #05CE78;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 28px;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            border: 3px solid #05CE78;
            z-index: 20;
            transition: transform 0.2s;
        }
        
        .i-button:active {
            transform: scale(0.95);
        }
        
        /* Auto-play indicator */
        .autoplay-indicator {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0,0,0,0.4);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.75em;
            z-index: 10;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .autoplay-indicator .pulse {
            width: 8px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }
        
        .card-content {
            padding: 20px;
            text-align: center;
        }
        
        .card-content h2 {
            color: #2d3748;
            font-size: 1.25em;
            margin-bottom: 6px;
        }
        
        .card-content p {
            color: #718096;
            font-size: 0.9em;
        }
        
        /* Template Selector */
        .template-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            max-width: 420px;
            margin: 0 auto 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .template-section h3 {
            color: #05CE78;
            font-size: 1.1em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .template-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .template-btn {
            flex: 1;
            min-width: calc(50% - 4px);
            padding: 12px 10px;
            border: 2px solid #e2e8f0;
            background: white;
            border-radius: 10px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
        }
        
        .template-btn:hover {
            border-color: #05CE78;
            background: #f0fff4;
        }
        
        .template-btn.active {
            border-color: #05CE78;
            background: #05CE78;
            color: white;
        }
        
        /* Form Section */
        .form-section {
            background: white;
            border-radius: 16px;
            padding: 20px;
            max-width: 420px;
            margin: 0 auto 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.08);
        }
        
        .form-section h3 {
            color: #05CE78;
            margin-bottom: 4px;
            font-size: 1.1em;
        }
        
        .form-section .subtitle {
            color: #999;
            font-size: 0.85em;
            margin-bottom: 18px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            color: #555;
            font-size: 0.85em;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 11px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.95em;
            font-family: inherit;
            transition: border-color 0.2s;
        }
        
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #05CE78;
        }
        
        .form-group textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        /* Image inputs section */
        .images-section {
            background: #f8fffe;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px dashed #05CE78;
        }
        
        .images-section h4 {
            color: #05CE78;
            font-size: 0.95em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .image-input-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }
        
        .image-input-row:last-child {
            margin-bottom: 0;
        }
        
        .image-input-row .num {
            width: 24px;
            height: 24px;
            background: #05CE78;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75em;
            font-weight: bold;
            flex-shrink: 0;
        }
        
        .image-input-row input {
            flex: 1;
            padding: 9px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.85em;
        }
        
        .image-input-row input:focus {
            outline: none;
            border-color: #05CE78;
        }
        
        .image-status {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            flex-shrink: 0;
        }
        
        .image-status.loaded {
            background: #d4edda;
            color: #28a745;
        }
        
        .image-status.empty {
            background: #e2e8f0;
            color: #999;
        }
        
        .image-status.error {
            background: #f8d7da;
            color: #dc3545;
        }
        
        /* Autoplay toggle */
        .autoplay-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .autoplay-toggle label {
            font-size: 0.9em;
            color: #555;
        }
        
        .toggle-switch {
            position: relative;
            width: 50px;
            height: 28px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 28px;
        }
        
        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }
        
        .toggle-switch input:checked + .toggle-slider {
            background-color: #05CE78;
        }
        
        .toggle-switch input:checked + .toggle-slider:before {
            transform: translateX(22px);
        }
        
        /* Hint text styles */
        .hint {
            font-size: 0.78em;
            color: #888;
            margin-top: 6px;
            line-height: 1.4;
        }
        
        .hint a {
            color: #05CE78;
            text-decoration: none;
        }
        
        .hint a:hover {
            text-decoration: underline;
        }
        
        .hint-icon {
            display: inline-block;
            width: 14px;
            height: 14px;
            background: #e2e8f0;
            color: #666;
            border-radius: 50%;
            font-size: 0.7em;
            text-align: center;
            line-height: 14px;
            margin-left: 4px;
            cursor: help;
        }
        
        /* Pro tip callout */
        .pro-tip {
            background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%);
            border-left: 3px solid #05CE78;
            padding: 12px 14px;
            border-radius: 0 10px 10px 0;
            margin: 15px 0;
            font-size: 0.85em;
            color: #2d3748;
        }
        
        .pro-tip strong {
            color: #05CE78;
        }
        
        /* SAVE SECTION - NEW */
        .save-section {
            background: linear-gradient(135deg, #05CE78 0%, #00A862 100%);
            border-radius: 16px;
            padding: 25px 20px;
            max-width: 420px;
            margin: 0 auto 20px;
            text-align: center;
            color: white;
        }
        
        .save-section h3 {
            font-size: 1.2em;
            margin-bottom: 8px;
        }
        
        .save-section p {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 18px;
        }
        
        .save-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .save-btn {
            padding: 14px 20px;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .save-btn.primary {
            background: white;
            color: #05CE78;
        }
        
        .save-btn.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }
        
        .save-btn.secondary {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 2px solid rgba(255,255,255,0.5);
        }
        
        .save-btn.secondary:hover {
            background: rgba(255,255,255,0.3);
        }
        
        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            max-width: 420px;
            margin: 0 auto;
        }
        
        .footer p {
            color: #888;
            font-size: 0.9em;
            margin-bottom: 12px;
        }
        
        .footer a {
            display: inline-block;
            color: #05CE78;
            text-decoration: none;
            font-weight: 600;
            padding: 12px 25px;
            border: 2px solid #05CE78;
            border-radius: 25px;
            transition: all 0.2s;
        }
        
        .footer a:hover, .footer a:active {
            background: #05CE78;
            color: white;
        }
        
        /* Popup Styles */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.75);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 15px;
        }
        
        .popup-overlay.active {
            display: flex;
        }
        
        .popup {
            background: white;
            border-radius: 20px;
            max-width: 420px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            animation: slideUp 0.3s ease;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .popup-header {
            background: linear-gradient(135deg, #05CE78 0%, #00A862 100%);
            color: white;
            padding: 22px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .popup-header h3 {
            font-size: 1.3em;
            margin-bottom: 4px;
        }
        
        .popup-header p {
            opacity: 0.9;
            font-size: 0.9em;
        }
        
        .close-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 32px;
            height: 32px;
            background: rgba(255,255,255,0.2);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .popup-body {
            padding: 22px;
        }
        
        .section {
            margin-bottom: 20px;
        }
        
        .section:last-of-type {
            margin-bottom: 0;
        }
        
        .section h4 {
            color: #05CE78;
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        
        .section p {
            color: #4a5568;
            line-height: 1.65;
            font-size: 0.95em;
        }
        
        .popup-button {
            display: block;
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #05CE78 0%, #00A862 100%);
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.05em;
            margin-top: 22px;
            border: none;
            cursor: pointer;
        }
        
        /* Photo picker styles */
        .select-photos-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #05CE78 0%, #00A862 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .select-photos-btn:active {
            transform: scale(0.98);
        }
        
        .image-thumbs-row {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            justify-content: center;
        }
        
        .image-thumb {
            width: 55px;
            height: 55px;
            border-radius: 10px;
            background: #e2e8f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9em;
            color: #999;
            overflow: hidden;
            border: 2px solid #e2e8f0;
        }
        
        .image-thumb.filled {
            border-color: #05CE78;
        }
        
        .image-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .url-input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.85em;
            margin-bottom: 8px;
        }
        
        .url-input:focus {
            outline: none;
            border-color: #05CE78;
        }
        
        /* URL options styling */
        .url-options-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 0.85em;
            color: #05CE78;
            cursor: pointer;
            padding: 8px 0;
        }
        
        .url-options-header:hover {
            color: #00A862;
        }
        
        .url-hint-box {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 10px 12px;
            margin-bottom: 10px;
            font-size: 0.8em;
            color: #666;
        }
        
        .url-hint-box a {
            color: #05CE78;
            text-decoration: none;
        }
        
        /* Text overlay on slides */
        .slide-overlay {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 0.95em;
            font-weight: 500;
            z-index: 15;
            white-space: nowrap;
            animation: fadeInUp 0.5s ease;
        }
        
        .slide-overlay.hidden {
            display: none;
        }
        
        @keyframes fadeInUp {
            from { 
                opacity: 0; 
                transform: translateX(-50%) translateY(10px);
            }
            to { 
                opacity: 1; 
                transform: translateX(-50%) translateY(0);
            }
        }
        
        /* Code Output Popup */
        .code-popup {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            overflow: hidden;
            position: relative;
            animation: slideUp 0.3s ease;
        }
        
        .code-output-container {
            background: #1a202c;
            color: #48bb78;
            padding: 15px;
            margin: 15px;
            border-radius: 10px;
            max-height: 250px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.7em;
            line-height: 1.4;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        
        .code-actions {
            padding: 0 20px 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .copy-code-btn {
            width: 100%;
            padding: 14px;
            background: #05CE78;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
        }
        
        .copy-code-btn:hover {
            background: #00A862;
        }
        
        .copy-code-btn.copied {
            background: #28a745;
        }
        
        .download-btn {
            width: 100%;
            padding: 14px;
            background: white;
            color: #05CE78;
            border: 2px solid #05CE78;
            border-radius: 10px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
        }
        
        .download-btn:hover {
            background: #f0fff4;
        }
        
        .code-note {
            text-align: center;
            font-size: 0.8em;
            color: #888;
            margin-top: 10px;
        }
        
        .code-note a {
            color: #05CE78;
        }
        
        /* AI Section Styles */
        .ai-generate-btn {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #05CE78 0%, #00A862 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .ai-generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(5, 206, 120, 0.4);
        }
        
        .ai-generate-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .ai-loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #05CE78;
        }
        
        .ai-loading.show {
            display: block;
        }
        
        .ai-spinner {
            width: 30px;
            height: 30px;
            border: 3px solid #e2e8f0;
            border-top-color: #05CE78;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .ai-error {
            display: none;
            background: #fff5f5;
            border: 1px solid #fc8181;
            color: #c53030;
            padding: 12px 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.9em;
        }
        
        .ai-error.show {
            display: block;
        }
        
        .ai-success {
            background: #f0fff4;
            border: 1px solid #68d391;
            color: #276749;
            padding: 12px 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.9em;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="page-header">
        <h1>iTabs for GoFundMe</h1>
        <p>Turn your story into something people actually read</p>
        <p style="font-size: 0.85em; color: #999; margin-top: 8px;">üëá Tap the "i" button to see how it works</p>
    </div>

    <!-- The iTabs Preview Card -->
    <div class="card">
        <div class="slideshow-container" id="slideshow">
            <div class="autoplay-indicator" id="autoplayIndicator" style="display: none;">
                <div class="pulse"></div>
                <span>Auto</span>
            </div>
            <div class="slides-track" id="slidesTrack">
                <!-- Slides generated by JS -->
            </div>
            <div class="slide-overlay hidden" id="slideOverlay"></div>
            <div class="dots-container" id="dotsContainer">
                <!-- Dots generated by JS -->
            </div>
            <div class="i-button" onclick="openPopup()">i</div>
        </div>
        <div class="card-content">
            <h2 id="previewTitle">Your Campaign Name</h2>
            <p id="previewSubtitle">Swipe photos ‚Ä¢ Tap i for the full story</p>
        </div>
    </div>

    <!-- Why iTabs Section -->
    <div class="template-section" style="background: linear-gradient(135deg, #fffbf0 0%, #fff5e6 100%); border: 1px solid #ffd699;">
        <h3 style="color: #e67e00;">ü§î Why use iTabs?</h3>
        <p style="color: #666; font-size: 0.9em; line-height: 1.6; margin-top: 10px;">
            <strong>Problem:</strong> Most GoFundMe pages are walls of text. People scroll past without reading.<br><br>
            <strong>Solution:</strong> iTabs shows photos first (people stop to look), then the "i" button lets them dive deeper. They CHOOSE to learn more - which means they're already engaged.<br><br>
            <strong>Result:</strong> More people understand your story ‚Üí More trust ‚Üí More donations.
        </p>
    </div>

    <!-- Template Selector -->
    <div class="template-section">
        <h3>üé® See Examples</h3>
        <div class="template-buttons">
            <button class="template-btn" onclick="loadTemplate('medical')">Medical</button>
            <button class="template-btn" onclick="loadTemplate('memorial')">Memorial</button>
            <button class="template-btn" onclick="loadTemplate('disaster')">Emergency</button>
            <button class="template-btn active" onclick="loadTemplate('blank')">Start Blank</button>
        </div>
        <p class="hint">See how different campaigns look, or start fresh</p>
    </div>

    <!-- AI SECTION -->
    <div class="form-section" style="background: linear-gradient(135deg, #f0fff4 0%, #e6fffa 100%); border: 2px solid #05CE78;">
        <h3>ü§ñ Let AI Structure Your Story</h3>
        <p class="subtitle">Paste your GoFundMe text ‚Üí AI organizes it into visual sections</p>
        
        <div class="form-group">
            <label>Paste your GoFundMe story here</label>
            <textarea id="storyText" placeholder="Copy your GoFundMe campaign text and paste it here. Include everything - the more detail, the better AI can help.

Don't have a GoFundMe yet? Just describe your situation:
- What happened?
- Who needs help?
- How much do you need and for what?
- Why should people trust this?" style="min-height: 150px;"></textarea>
            <p class="hint">üí° Go to your GoFundMe ‚Üí Select all the text ‚Üí Copy ‚Üí Paste here</p>
        </div>
        
        <div class="form-group">
            <label>Your GoFundMe link (so the Donate button works)</label>
            <input type="url" id="gofundmeUrl" placeholder="https://gofundme.com/f/your-campaign">
        </div>
        
        <div class="form-group">
            <label>Gemini API Key</label>
            <input type="text" id="geminiKey" placeholder="Paste your free Gemini key">
            <p class="hint">
                <a href="https://aistudio.google.com/app/apikey" target="_blank" style="color: #05CE78; font-weight: 600;">Get free key from Google ‚Üí</a> 
                (Takes 30 seconds, no credit card needed)
            </p>
        </div>
        
        <button type="button" class="ai-generate-btn" id="aiGenerateBtn" onclick="generateWithAI()">
            ‚ú® Turn My Story into iTabs
        </button>
        
        <div class="ai-loading" id="aiLoading">
            <div class="ai-spinner"></div>
            <span id="aiLoadingText">Organizing your story...</span>
        </div>
        
        <div class="ai-error" id="aiError"></div>
        
        <div class="pro-tip" style="margin-top: 15px; margin-bottom: 0;">
            <strong>What AI does:</strong> Takes your story and organizes it into 4 clear sections - The Crisis, Why Help, Where Money Goes, and Why Trust This. It uses YOUR facts, just structures them better.
        </div>
    </div>

    <!-- The Form -->
    <div class="form-section">
        <h3>‚úèÔ∏è Edit Content</h3>
        <p class="subtitle">AI fills this in - you can edit anything</p>
        
        <div class="form-group">
            <label>Campaign / Product Name</label>
            <input type="text" id="productName" placeholder="e.g., Help Sarah's Medical Fund" oninput="updatePreview()">
        </div>
        
        <!-- Image Selection -->
        <div class="images-section">
            <h4>üì∑ Your Photos</h4>
            <p class="hint" style="margin-bottom: 12px; color: #666;">
                <strong>Best photos for fundraising:</strong> The person who needs help, family moments, medical/damage evidence, before/after, the goal (new home, treatment, etc.)
            </p>
            
            <button type="button" class="select-photos-btn" onclick="document.getElementById('photosPicker').click()">
                üì± Select Photos from Phone
            </button>
            <p class="hint" style="text-align: center;">Choose up to 5 photos - they stay on your device</p>
            
            <!-- Hidden multi-file input -->
            <input type="file" id="photosPicker" accept="image/*" multiple style="display:none" onchange="handleMultipleFiles(this)">
            
            <!-- Thumbnails preview -->
            <div class="image-thumbs-row" id="thumbsRow">
                <div class="image-thumb empty" id="thumb1"><span>1</span></div>
                <div class="image-thumb empty" id="thumb2"><span>2</span></div>
                <div class="image-thumb empty" id="thumb3"><span>3</span></div>
                <div class="image-thumb empty" id="thumb4"><span>4</span></div>
                <div class="image-thumb empty" id="thumb5"><span>5</span></div>
            </div>
            
            <!-- Hidden storage for image data -->
            <input type="hidden" id="image1">
            <input type="hidden" id="image2">
            <input type="hidden" id="image3">
            <input type="hidden" id="image4">
            <input type="hidden" id="image5">
            
            <!-- Optional URL paste (collapsed) -->
            <details style="margin-top: 15px;">
                <summary class="url-options-header">Or paste image URLs instead ‚ñæ</summary>
                <div style="margin-top: 10px;">
                    <div class="url-hint-box">
                        üí° Get free image URLs from <a href="https://imgbb.com" target="_blank">imgbb.com</a> or <a href="https://imgur.com" target="_blank">imgur.com</a><br>
                        Or right-click any image online ‚Üí "Copy image address"
                    </div>
                    <input type="url" class="url-input" placeholder="Image 1 URL..." oninput="handleUrlInput(1, this.value)">
                    <input type="url" class="url-input" placeholder="Image 2 URL..." oninput="handleUrlInput(2, this.value)">
                    <input type="url" class="url-input" placeholder="Image 3 URL..." oninput="handleUrlInput(3, this.value)">
                    <input type="url" class="url-input" placeholder="Image 4 URL..." oninput="handleUrlInput(4, this.value)">
                    <input type="url" class="url-input" placeholder="Image 5 URL..." oninput="handleUrlInput(5, this.value)">
                </div>
            </details>
        </div>
        
        <!-- Autoplay toggle -->
        <div class="autoplay-toggle">
            <label>Auto-play slideshow</label>
            <div class="toggle-switch">
                <input type="checkbox" id="autoplayToggle" checked onchange="toggleAutoplay()">
                <span class="toggle-slider"></span>
            </div>
        </div>
        
        <div class="form-group">
            <label>First-loop overlay text (optional)</label>
            <input type="text" id="overlayText" placeholder="e.g. Every Dollar Helps ‚Üí" oninput="updatePreview()">
            <p class="hint">Shows on first slide, disappears after first loop</p>
        </div>
        
        <div class="form-group">
            <label>What is it? / The Crisis</label>
            <textarea id="section1" placeholder="What happened? Who needs help?" oninput="updatePreview()"></textarea>
        </div>
        
        <div class="form-group">
            <label>Why help? / The Impact</label>
            <textarea id="section2" placeholder="Why does this matter? What's at stake?" oninput="updatePreview()"></textarea>
        </div>
        
        <div class="form-group">
            <label>Where does the money go?</label>
            <textarea id="section3" placeholder="Specific breakdown of how funds will be used..." oninput="updatePreview()"></textarea>
        </div>
        
        <div class="form-group">
            <label>Why trust this? / What's different?</label>
            <textarea id="section4" placeholder="What makes this legitimate/special?" oninput="updatePreview()"></textarea>
        </div>
        
        <div class="form-group">
            <label>Button Text</label>
            <input type="text" id="buttonText" placeholder="e.g. Donate Now" oninput="updatePreview()">
        </div>
        
        <div class="form-group">
            <label>Button Link (your GoFundMe/campaign URL)</label>
            <input type="url" id="buttonLink" placeholder="https://gofundme.com/f/your-campaign" oninput="updatePreview()">
            <p class="hint">This is where people go when they click the button</p>
        </div>
    </div>

    <!-- SAVE SECTION - NEW -->
    <div class="save-section">
        <h3>üíæ Save Your iTabs</h3>
        <p>Happy with what you made? Take it with you!</p>
        <div class="save-buttons">
            <button class="save-btn primary" onclick="showCodePopup()">
                üìã Get Code to Embed
            </button>
            <button class="save-btn secondary" onclick="downloadHTML()">
                üì• Download as HTML File
            </button>
        </div>
    </div>

    <!-- Footer with Next Steps -->
    <div class="footer">
        <div style="background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 15px; text-align: left;">
            <p style="color: #555; font-size: 0.85em; margin-bottom: 8px;"><strong>üìç Where to use your iTabs:</strong></p>
            <ul style="color: #666; font-size: 0.8em; margin-left: 20px; line-height: 1.8;">
                <li>Share the HTML file link on social media</li>
                <li>Embed the code in your Linktree or Carrd</li>
                <li>Add to your blog or website</li>
                <li>Include link in your GoFundMe updates</li>
            </ul>
        </div>
        <p style="color: #999; font-size: 0.8em;">Made with iTabs ‚Ä¢ <a href="https://itabs.ai" style="color: #05CE78;">itabs.ai</a></p>
    </div>

    <!-- The Info Popup -->
    <div class="popup-overlay" id="popup" onclick="closePopup(event)">
        <div class="popup" onclick="event.stopPropagation()">
            <div class="popup-header">
                <button class="close-btn" onclick="closePopup()">&times;</button>
                <h3 id="popupTitle">Campaign Name</h3>
                <p>The full story</p>
            </div>
            <div class="popup-body">
                <div class="section" id="popupSection1">
                    <h4>üö® The Crisis</h4>
                    <p id="popupText1"></p>
                </div>
                
                <div class="section" id="popupSection2">
                    <h4>üíî Why We Need Help</h4>
                    <p id="popupText2"></p>
                </div>
                
                <div class="section" id="popupSection3">
                    <h4>üí∞ Where Money Goes</h4>
                    <p id="popupText3"></p>
                </div>
                
                <div class="section" id="popupSection4">
                    <h4>‚úÖ Why Trust This</h4>
                    <p id="popupText4"></p>
                </div>
                
                <a href="#" id="popupButton" class="popup-button" target="_blank">Donate Now</a>
            </div>
        </div>
    </div>

    <!-- Code Output Popup - NEW -->
    <div class="popup-overlay" id="codePopup" onclick="closeCodePopup(event)">
        <div class="code-popup" onclick="event.stopPropagation()">
            <div class="popup-header">
                <button class="close-btn" onclick="closeCodePopup()">&times;</button>
                <h3>üìã Your iTabs Code</h3>
                <p>Copy this and paste into your website</p>
            </div>
            <div class="code-output-container" id="codeOutput">
                <!-- Code will be generated here -->
            </div>
            <div class="code-actions">
                <button class="copy-code-btn" id="copyCodeBtn" onclick="copyCode()">
                    üìã Copy Code
                </button>
                <button class="download-btn" onclick="downloadHTML()">
                    üì• Download as HTML File
                </button>
                <p class="code-note">
                    Works on: Carrd, Notion, WordPress, Squarespace, anywhere that accepts HTML
                </p>
            </div>
        </div>
    </div>

    <script>
        // Templates - Different fundraising campaign types
        const templates = {
            medical: {
                name: "Help Sarah's Cancer Treatment",
                images: [
                    "https://images.unsplash.com/photo-1579684385127-1ef15d508118?w=600",
                    "https://images.unsplash.com/photo-1516574187841-cb9cc2ca948b?w=600",
                    "https://images.unsplash.com/photo-1559839734-2b71ea197ec2?w=600",
                    "https://images.unsplash.com/photo-1581595219315-a187dd40c322?w=600",
                    "https://images.unsplash.com/photo-1559839914-17aae19cec71?w=600"
                ],
                section1: "Sarah, a 34-year-old mother of two, was diagnosed with stage 3 breast cancer last month. She needs immediate chemotherapy followed by surgery. Her treatment starts next week and will continue for 6 months.",
                section2: "Sarah is a single mum who works as a teacher. She'll have to stop working during treatment. Without help, she risks losing her home while fighting for her life. Her kids, Emma (8) and Jake (5), need their mum.",
                section3: "$25,000 - Chemotherapy and medical bills not covered by insurance. $15,000 - Living expenses during 6 months of treatment. $5,000 - Transport to specialist hospital 2 hours away. Every dollar goes directly to Sarah's care.",
                section4: "This campaign is run by Sarah's sister, Michelle. We'll post weekly updates with receipts. Sarah's oncologist Dr. Peters has verified her diagnosis. All unused funds will be donated to the Cancer Council.",
                buttonText: "Donate Now",
                buttonLink: "https://gofundme.com",
                overlayText: "Help Sarah Fight üíö"
            },
            memorial: {
                name: "Honouring Dad - Funeral Costs",
                images: [
                    "https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600",
                    "https://images.unsplash.com/photo-1474552226712-ac0f0961a954?w=600",
                    "https://images.unsplash.com/photo-1529156069898-49953e39b3ac?w=600",
                    "https://images.unsplash.com/photo-1511895426328-dc8714191300?w=600",
                    "https://images.unsplash.com/photo-1518495973542-4542c06a5843?w=600"
                ],
                section1: "Our father, Robert Thompson, passed away suddenly on December 3rd from a heart attack. He was 58 years old. Dad was a tradie who spent his life helping others but never had life insurance.",
                section2: "Dad left behind mum (who hasn't worked in 20 years), and three kids still in school. We want to give him the send-off he deserves and make sure mum can stay in their home while she gets back on her feet.",
                section3: "$8,000 - Funeral service and burial costs. $5,000 - Outstanding medical bills from emergency care. $7,000 - Help mum with mortgage while she finds work. We've already covered what we could ourselves.",
                section4: "We're the Thompson family from Brisbane. Dad coached junior footy for 15 years - many of you knew him. We'll share photos from the service and keep everyone updated on how mum is doing.",
                buttonText: "Support the Family",
                buttonLink: "https://gofundme.com",
                overlayText: "In Loving Memory üïäÔ∏è"
            },
            disaster: {
                name: "Rebuild After the Bushfire",
                images: [
                    "https://images.unsplash.com/photo-1602615576820-ea14cf3e476a?w=600",
                    "https://images.unsplash.com/photo-1580974852861-c381510bc98a?w=600",
                    "https://images.unsplash.com/photo-1523217582562-09d0def993a6?w=600",
                    "https://images.unsplash.com/photo-1600585154340-be6161a56a0c?w=600",
                    "https://images.unsplash.com/photo-1516156008625-3a9d6067fab5?w=600"
                ],
                section1: "On January 15th, bushfires tore through our property in the Adelaide Hills. We lost our home of 22 years, our shed, and both cars. We escaped with our dog and the clothes on our backs.",
                section2: "We're staying with family but can't impose forever. Insurance is fighting our claim and it could take months. We need to rebuild our lives and find somewhere permanent for our family of four to live.",
                section3: "$10,000 - Bond and rent for temporary housing. $5,000 - Replace essential furniture, clothes, and school supplies. $8,000 - Tools so Dave can get back to work (he's a carpenter). $2,000 - Emergency vet bills for Rusty.",
                section4: "We're Dave and Karen Mitchell. Our story was covered by ABC Adelaide. We'll post photos of our recovery journey and show exactly where every dollar goes. Local CFS can verify the fire destroyed our home.",
                buttonText: "Help Us Rebuild",
                buttonLink: "https://gofundme.com",
                overlayText: "We Lost Everything üè†"
            },
            blank: {
                name: "",
                images: ["", "", "", "", ""],
                section1: "",
                section2: "",
                section3: "",
                section4: "",
                buttonText: "",
                buttonLink: "",
                overlayText: ""
            }
        };
        
        let currentSlide = 0;
        let autoplayInterval = null;
        let touchStartX = 0;
        let touchEndX = 0;
        let firstLoopComplete = false;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadTemplate('blank');
            setupTouchEvents();
            if (document.getElementById('autoplayToggle').checked) {
                startAutoplay();
            }
        });
        
        function loadTemplate(templateName) {
            const template = templates[templateName];
            
            // Update button states
            document.querySelectorAll('.template-btn').forEach(btn => {
                btn.classList.remove('active');
                const btnText = btn.textContent.toLowerCase();
                if (btnText.includes(templateName) || 
                    (templateName === 'blank' && btnText.includes('blank'))) {
                    btn.classList.add('active');
                }
            });
            
            // Fill form
            document.getElementById('productName').value = template.name;
            document.getElementById('image1').value = template.images[0];
            document.getElementById('image2').value = template.images[1];
            document.getElementById('image3').value = template.images[2];
            document.getElementById('image4').value = template.images[3];
            document.getElementById('image5').value = template.images[4];
            document.getElementById('section1').value = template.section1;
            document.getElementById('section2').value = template.section2;
            document.getElementById('section3').value = template.section3;
            document.getElementById('section4').value = template.section4;
            document.getElementById('buttonText').value = template.buttonText;
            document.getElementById('buttonLink').value = template.buttonLink;
            document.getElementById('overlayText').value = template.overlayText || '';
            
            // Update thumbnails
            template.images.forEach((url, index) => {
                const num = index + 1;
                const thumb = document.getElementById('thumb' + num);
                if (url && url.trim()) {
                    thumb.innerHTML = `<img src="${url}" alt="Photo ${num}">`;
                    thumb.classList.add('filled');
                    thumb.classList.remove('empty');
                } else {
                    thumb.innerHTML = `<span>${num}</span>`;
                    thumb.classList.remove('filled');
                    thumb.classList.add('empty');
                }
            });
            
            currentSlide = 0;
            firstLoopComplete = false;
            updatePreview();
            updateOverlayVisibility();
            
            if (document.getElementById('autoplayToggle').checked) {
                startAutoplay();
            }
        }
        
        function updatePreview() {
            const productName = document.getElementById('productName').value || 'Your Campaign';
            const images = [
                document.getElementById('image1').value,
                document.getElementById('image2').value,
                document.getElementById('image3').value,
                document.getElementById('image4').value,
                document.getElementById('image5').value
            ];
            const section1 = document.getElementById('section1').value;
            const section2 = document.getElementById('section2').value;
            const section3 = document.getElementById('section3').value;
            const section4 = document.getElementById('section4').value;
            const buttonText = document.getElementById('buttonText').value || 'Learn More';
            const buttonLink = document.getElementById('buttonLink').value || '#';
            
            document.getElementById('previewTitle').textContent = productName;
            document.getElementById('popupTitle').textContent = productName;
            
            const slidesTrack = document.getElementById('slidesTrack');
            const dotsContainer = document.getElementById('dotsContainer');
            
            let slidesHTML = '';
            let dotsHTML = '';
            
            images.forEach((url, index) => {
                if (url && url.trim()) {
                    slidesHTML += `<div class="slide"><img src="${url}" alt="Photo ${index + 1}" onerror="this.parentElement.innerHTML='<div class=\\'placeholder-content\\'><div class=\\'num\\'>!</div><p>Image failed to load</p></div>'"></div>`;
                    updateImageStatus(index + 1, 'loading', url);
                } else {
                    slidesHTML += `<div class="slide"><div class="placeholder-content"><div class="num">${index + 1}</div><p>Add photo</p></div></div>`;
                    updateImageStatus(index + 1, 'empty');
                }
                
                const isActive = index === currentSlide ? 'active' : '';
                dotsHTML += `<div class="dot ${isActive}" onclick="goToSlide(${index})"></div>`;
            });
            
            slidesTrack.innerHTML = slidesHTML;
            dotsContainer.innerHTML = dotsHTML;
            slidesTrack.style.transform = `translateX(-${currentSlide * 100}%)`;
            
            images.forEach((url, index) => {
                if (url && url.trim()) {
                    const img = new Image();
                    img.onload = () => updateImageStatus(index + 1, 'loaded');
                    img.onerror = () => updateImageStatus(index + 1, 'error');
                    img.src = url;
                }
            });
            
            document.getElementById('popupText1').textContent = section1 || 'Add content in the form below.';
            document.getElementById('popupText2').textContent = section2 || 'Explain why this matters.';
            document.getElementById('popupText3').textContent = section3 || 'Show where the money goes.';
            document.getElementById('popupText4').textContent = section4 || 'Build trust with transparency.';
            document.getElementById('popupButton').textContent = buttonText;
            document.getElementById('popupButton').href = buttonLink;
            
            document.getElementById('popupSection1').style.display = section1 ? 'block' : 'none';
            document.getElementById('popupSection2').style.display = section2 ? 'block' : 'none';
            document.getElementById('popupSection3').style.display = section3 ? 'block' : 'none';
            document.getElementById('popupSection4').style.display = section4 ? 'block' : 'none';
        }
        
        function updateImageStatus(num, status, url) {
            const thumb = document.getElementById('thumb' + num);
            if (!thumb) return;
            
            if (status === 'loaded' && url) {
                thumb.innerHTML = `<img src="${url}" alt="Photo ${num}">`;
                thumb.classList.add('filled');
                thumb.classList.remove('empty');
            } else if (status === 'error') {
                thumb.innerHTML = `<span>!</span>`;
                thumb.classList.remove('filled');
                thumb.classList.add('empty');
            } else if (status === 'empty') {
                thumb.innerHTML = `<span>${num}</span>`;
                thumb.classList.remove('filled');
                thumb.classList.add('empty');
            }
        }
        
        function goToSlide(index) {
            if (index === 0 && currentSlide === 4) {
                firstLoopComplete = true;
                hideOverlay();
            }
            
            currentSlide = index;
            const slidesTrack = document.getElementById('slidesTrack');
            slidesTrack.style.transform = `translateX(-${currentSlide * 100}%)`;
            
            document.querySelectorAll('.dot').forEach((dot, i) => {
                dot.classList.toggle('active', i === currentSlide);
            });
            
            updateOverlayVisibility();
        }
        
        function updateOverlayVisibility() {
            const overlay = document.getElementById('slideOverlay');
            const overlayText = document.getElementById('overlayText').value;
            
            if (overlayText && currentSlide === 0 && !firstLoopComplete) {
                overlay.textContent = overlayText;
                overlay.classList.remove('hidden');
            } else {
                overlay.classList.add('hidden');
            }
        }
        
        function hideOverlay() {
            const overlay = document.getElementById('slideOverlay');
            overlay.classList.add('hidden');
        }
        
        function nextSlide() {
            const totalSlides = 5;
            currentSlide = (currentSlide + 1) % totalSlides;
            goToSlide(currentSlide);
        }
        
        function prevSlide() {
            const totalSlides = 5;
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            goToSlide(currentSlide);
        }
        
        function startAutoplay() {
            stopAutoplay();
            autoplayInterval = setInterval(nextSlide, 3000);
            document.getElementById('autoplayIndicator').style.display = 'flex';
        }
        
        function stopAutoplay() {
            if (autoplayInterval) {
                clearInterval(autoplayInterval);
                autoplayInterval = null;
            }
            document.getElementById('autoplayIndicator').style.display = 'none';
        }
        
        function toggleAutoplay() {
            if (document.getElementById('autoplayToggle').checked) {
                startAutoplay();
            } else {
                stopAutoplay();
            }
        }
        
        function setupTouchEvents() {
            const slideshow = document.getElementById('slideshow');
            
            slideshow.addEventListener('touchstart', e => {
                touchStartX = e.changedTouches[0].screenX;
            }, false);
            
            slideshow.addEventListener('touchend', e => {
                touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, false);
        }
        
        function handleSwipe() {
            const diff = touchStartX - touchEndX;
            if (Math.abs(diff) > 50) {
                if (diff > 0) {
                    nextSlide();
                } else {
                    prevSlide();
                }
            }
        }
        
        function openPopup() {
            document.getElementById('popup').classList.add('active');
            document.body.style.overflow = 'hidden';
            stopAutoplay();
        }
        
        function closePopup(event) {
            if (!event || event.target.id === 'popup' || event.target.classList.contains('close-btn')) {
                document.getElementById('popup').classList.remove('active');
                document.body.style.overflow = '';
                if (document.getElementById('autoplayToggle').checked) {
                    startAutoplay();
                }
            }
        }
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePopup();
                closeCodePopup();
            }
        });
        
        function handleMultipleFiles(input) {
            const files = Array.from(input.files).slice(0, 5);
            
            files.forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const imageData = e.target.result;
                    const num = index + 1;
                    
                    document.getElementById('image' + num).value = imageData;
                    
                    const thumb = document.getElementById('thumb' + num);
                    thumb.innerHTML = `<img src="${imageData}" alt="Photo ${num}">`;
                    thumb.classList.add('filled');
                    thumb.classList.remove('empty');
                    
                    updatePreview();
                };
                reader.readAsDataURL(file);
            });
        }
        
        function handleUrlInput(num, url) {
            document.getElementById('image' + num).value = url;
            
            const thumb = document.getElementById('thumb' + num);
            if (url && url.trim()) {
                const img = new Image();
                img.onload = function() {
                    thumb.innerHTML = `<img src="${url}" alt="Photo ${num}">`;
                    thumb.classList.add('filled');
                    thumb.classList.remove('empty');
                    updatePreview();
                };
                img.onerror = function() {
                    thumb.innerHTML = `<span>!</span>`;
                    thumb.classList.remove('filled');
                    updatePreview();
                };
                img.src = url;
            } else {
                thumb.innerHTML = `<span>${num}</span>`;
                thumb.classList.remove('filled');
                thumb.classList.add('empty');
                updatePreview();
            }
        }
        
        // ============ CODE GENERATION - NEW ============
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function generateCode() {
            const productName = escapeHtml(document.getElementById('productName').value || 'Your Campaign');
            const section1 = escapeHtml(document.getElementById('section1').value);
            const section2 = escapeHtml(document.getElementById('section2').value);
            const section3 = escapeHtml(document.getElementById('section3').value);
            const section4 = escapeHtml(document.getElementById('section4').value);
            const buttonText = escapeHtml(document.getElementById('buttonText').value || 'Donate Now');
            const buttonLink = document.getElementById('buttonLink').value || '#';
            const overlayText = escapeHtml(document.getElementById('overlayText').value || '');
            
            const images = [
                document.getElementById('image1').value,
                document.getElementById('image2').value,
                document.getElementById('image3').value,
                document.getElementById('image4').value,
                document.getElementById('image5').value
            ].filter(url => url && url.trim());
            
            if (images.length === 0) {
                return '<!-- Please add at least one image to generate code -->';
            }
            
            // Build slides HTML
            let slidesHTML = '';
            let dotsHTML = '';
            
            images.forEach((url, index) => {
                slidesHTML += `        <div style="min-width: 100%; height: 100%;">
            <img src="${url}" alt="${productName} ${index + 1}" style="width: 100%; height: 100%; object-fit: cover;">
            ${index === 0 && overlayText ? `<div style="position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: white; padding: 10px 20px; border-radius: 25px; font-size: 0.95em; font-weight: 500; z-index: 15; white-space: nowrap;">${overlayText}</div>` : ''}
        </div>\n`;
                
                const bgColor = index === 0 ? 'white' : 'rgba(255,255,255,0.5)';
                dotsHTML += `        <div class="itabs-dot" data-slide="${index}" style="width: 10px; height: 10px; border-radius: 50%; background: ${bgColor}; cursor: pointer; transition: all 0.3s; border: 2px solid white;"></div>\n`;
            });
            
            // Build popup content
            let popupHTML = '';
            if (section1) popupHTML += `            <h4 style="color: #05CE78; font-size: 1.1em; margin-bottom: 8px;">üö® The Crisis</h4>\n            <p style="color: #4a5568; line-height: 1.65; font-size: 0.95em; margin-bottom: 20px;">${section1}</p>\n`;
            if (section2) popupHTML += `            <h4 style="color: #05CE78; font-size: 1.1em; margin-bottom: 8px;">üíî Why We Need Help</h4>\n            <p style="color: #4a5568; line-height: 1.65; font-size: 0.95em; margin-bottom: 20px;">${section2}</p>\n`;
            if (section3) popupHTML += `            <h4 style="color: #05CE78; font-size: 1.1em; margin-bottom: 8px;">üí∞ Where Money Goes</h4>\n            <p style="color: #4a5568; line-height: 1.65; font-size: 0.95em; margin-bottom: 20px;">${section3}</p>\n`;
            if (section4) popupHTML += `            <h4 style="color: #05CE78; font-size: 1.1em; margin-bottom: 8px;">‚úÖ Why Trust This</h4>\n            <p style="color: #4a5568; line-height: 1.65; font-size: 0.95em; margin-bottom: 20px;">${section4}</p>\n`;
            
            // Generate full code
            let code = `<!-- iTabs for GoFundMe - Created at itabs.ai -->
<div style="background: white; border-radius: 20px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.12); max-width: 420px; margin: 20px auto; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
    <div style="position: relative; width: 100%; height: 280px; overflow: hidden; background: linear-gradient(135deg, #05CE78 0%, #00A862 100%);">
        <div id="itabsTrack" style="display: flex; height: 100%; transition: transform 0.4s ease;">
${slidesHTML}        </div>
        <div style="position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; z-index: 10;">
${dotsHTML}        </div>
        <div id="itabsCounter" style="position: absolute; bottom: 15px; right: 70px; background: rgba(0,0,0,0.5); color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; z-index: 10;">1/${images.length}</div>
        <div onclick="document.getElementById('itabsPopup').style.display='flex'" style="position: absolute; bottom: 15px; right: 15px; width: 50px; height: 50px; background: white; color: #05CE78; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 28px; cursor: pointer; box-shadow: 0 4px 20px rgba(0,0,0,0.3); border: 3px solid #05CE78; z-index: 20;">i</div>
    </div>
    <div style="padding: 20px; text-align: center;">
        <h2 style="color: #2d3748; font-size: 1.25em; margin-bottom: 6px;">${productName}</h2>
        <p style="color: #718096; font-size: 0.9em;">Swipe photos ‚Ä¢ Tap i for the full story</p>
    </div>
</div>

<!-- Popup -->
<div id="itabsPopup" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.75); z-index: 1000; align-items: center; justify-content: center; padding: 15px;">
    <div style="background: white; border-radius: 20px; max-width: 420px; width: 100%; max-height: 85vh; overflow-y: auto; position: relative;">
        <div style="background: linear-gradient(135deg, #05CE78 0%, #00A862 100%); color: white; padding: 22px; text-align: center; position: sticky; top: 0; z-index: 10;">
            <button onclick="document.getElementById('itabsPopup').style.display='none'" style="position: absolute; top: 12px; right: 12px; width: 32px; height: 32px; background: rgba(255,255,255,0.2); border: none; border-radius: 50%; color: white; font-size: 22px; cursor: pointer;">&times;</button>
            <h3 style="font-size: 1.3em; margin-bottom: 4px;">${productName}</h3>
            <p style="opacity: 0.9; font-size: 0.9em;">The full story</p>
        </div>
        <div style="padding: 22px;">
${popupHTML}            <a href="${buttonLink}" target="_blank" style="display: block; width: 100%; padding: 15px; background: linear-gradient(135deg, #05CE78 0%, #00A862 100%); color: white; text-align: center; text-decoration: none; border-radius: 12px; font-weight: bold; font-size: 1.05em; margin-top: 10px;">${buttonText}</a>
        </div>
    </div>
</div>

<script>
var itabsSlide = 0;
var itabsTotal = ${images.length};

function itabsUpdate() {
    document.getElementById('itabsTrack').style.transform = 'translateX(-' + (itabsSlide * 100) + '%)';
    document.getElementById('itabsCounter').textContent = (itabsSlide + 1) + '/' + itabsTotal;
    document.querySelectorAll('.itabs-dot').forEach(function(d, i) {
        d.style.background = i === itabsSlide ? 'white' : 'rgba(255,255,255,0.5)';
    });
}

document.querySelectorAll('.itabs-dot').forEach(function(d, i) {
    d.onclick = function() { itabsSlide = i; itabsUpdate(); };
});

var itabsTrack = document.getElementById('itabsTrack');
var itabsStartX = 0;
itabsTrack.ontouchstart = function(e) { itabsStartX = e.changedTouches[0].screenX; };
itabsTrack.ontouchend = function(e) {
    var diff = itabsStartX - e.changedTouches[0].screenX;
    if (Math.abs(diff) > 50) {
        itabsSlide = diff > 0 ? (itabsSlide + 1) % itabsTotal : (itabsSlide - 1 + itabsTotal) % itabsTotal;
        itabsUpdate();
    }
};

setInterval(function() { itabsSlide = (itabsSlide + 1) % itabsTotal; itabsUpdate(); }, 3000);

document.getElementById('itabsPopup').onclick = function(e) { if (e.target === this) this.style.display = 'none'; };
<\/script>

<!-- Made with iTabs - itabs.ai -->`;
            
            return code;
        }
        
        function showCodePopup() {
            const code = generateCode();
            document.getElementById('codeOutput').textContent = code;
            document.getElementById('codePopup').classList.add('active');
            document.body.style.overflow = 'hidden';
            stopAutoplay();
        }
        
        function closeCodePopup(event) {
            if (!event || event.target.id === 'codePopup' || event.target.classList.contains('close-btn')) {
                document.getElementById('codePopup').classList.remove('active');
                document.body.style.overflow = '';
                if (document.getElementById('autoplayToggle').checked) {
                    startAutoplay();
                }
            }
        }
        
        function copyCode() {
            const code = document.getElementById('codeOutput').textContent;
            const btn = document.getElementById('copyCodeBtn');
            
            navigator.clipboard.writeText(code).then(() => {
                btn.textContent = '‚úÖ Copied!';
                btn.classList.add('copied');
                setTimeout(() => {
                    btn.textContent = 'üìã Copy Code';
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = code;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    btn.textContent = '‚úÖ Copied!';
                    btn.classList.add('copied');
                    setTimeout(() => {
                        btn.textContent = 'üìã Copy Code';
                        btn.classList.remove('copied');
                    }, 2000);
                } catch (e) {
                    alert('Copy failed. Please select and copy the code manually.');
                }
                document.body.removeChild(textarea);
            });
        }
        
        function downloadHTML() {
            const code = generateCode();
            const fullHTML = `<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${document.getElementById('productName').value || 'My iTabs'}</title>
</head>
<body style="margin: 0; padding: 20px; background: #f5f5f5; min-height: 100vh;">
${code}
</body>
</html>`;
            
            const blob = new Blob([fullHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'my-itabs.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // ============ AI GENERATION ============
        
        async function generateWithAI() {
            const geminiKey = document.getElementById('geminiKey').value.trim();
            const storyText = document.getElementById('storyText').value.trim();
            const gofundmeUrl = document.getElementById('gofundmeUrl').value.trim();
            
            // Validation
            if (!geminiKey) {
                showAIError('Please enter your Gemini API key. <a href="https://aistudio.google.com/app/apikey" target="_blank">Get one free here ‚Üí</a>');
                return;
            }
            
            if (!storyText) {
                showAIError('Please paste your GoFundMe story text or describe your situation.');
                return;
            }
            
            const btn = document.getElementById('aiGenerateBtn');
            const loading = document.getElementById('aiLoading');
            const loadingText = document.getElementById('aiLoadingText');
            
            btn.disabled = true;
            loading.classList.add('show');
            hideAIError();
            loadingText.textContent = 'Organizing your story...';
            
            try {
                const prompt = `You are helping someone turn their GoFundMe story into a clear, visual iTabs display.

Here is their campaign story (use ONLY facts from this text - do not make anything up):

---
${storyText}
---

Reorganize this into 4 clear sections. Use ONLY the facts they provided. Keep their voice and emotion.

Return ONLY valid JSON:
{
    "campaignName": "Extract or create a clear campaign title from their story",
    "section1": "THE CRISIS - What happened? Who is affected? Pull the key facts. 2-3 sentences.",
    "section2": "WHY HELP - Why does this matter? What's at stake? Use their words. 2-3 sentences.", 
    "section3": "WHERE MONEY GOES - If they mention specific costs, list them. If not, say 'All funds go directly to [their stated need]'. Be specific if they were. 2-3 sentences.",
    "section4": "WHY TRUST - Any credibility they mentioned (verified, updates promised, who they are). If nothing specific, write something like 'We will post regular updates showing how funds are used.' 1-2 sentences.",
    "buttonText": "Donate Now",
    "overlayText": "A short 3-5 word emotional hook based on their story, with emoji"
}

IMPORTANT: 
- Use THEIR facts, names, numbers, and details
- Don't invent amounts or details they didn't share
- Keep their emotional tone
- Only return the JSON, nothing else`;

                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${geminiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message || 'API error');
                }
                
                if (data.candidates && data.candidates[0]?.content?.parts?.[0]?.text) {
                    const generatedText = data.candidates[0].content.parts[0].text;
                    const jsonMatch = generatedText.match(/\{[\s\S]*\}/);
                    
                    if (jsonMatch) {
                        const content = JSON.parse(jsonMatch[0]);
                        
                        // Fill in the form
                        document.getElementById('productName').value = content.campaignName || '';
                        document.getElementById('section1').value = content.section1 || '';
                        document.getElementById('section2').value = content.section2 || '';
                        document.getElementById('section3').value = content.section3 || '';
                        document.getElementById('section4').value = content.section4 || '';
                        document.getElementById('buttonText').value = content.buttonText || 'Donate Now';
                        document.getElementById('overlayText').value = content.overlayText || '';
                        
                        // Set button link to the GoFundMe URL if provided
                        if (gofundmeUrl) {
                            document.getElementById('buttonLink').value = gofundmeUrl;
                        }
                        
                        updatePreview();
                        
                        // Show success
                        loading.innerHTML = '<div class="ai-success">‚úÖ Done! Your story is now organized. Add photos and tweak anything you want.</div>';
                        setTimeout(() => {
                            loading.classList.remove('show');
                            loading.innerHTML = '<div class="ai-spinner"></div><span id="aiLoadingText">Organizing your story...</span>';
                            
                            // Scroll to the form
                            document.getElementById('productName').scrollIntoView({ behavior: 'smooth', block: 'center' });
                        }, 2500);
                        
                    } else {
                        throw new Error('Could not parse AI response');
                    }
                } else {
                    throw new Error('Invalid API response');
                }
                
            } catch (error) {
                console.error('AI Error:', error);
                showAIError('Something went wrong: ' + error.message + '. Please try again.');
                loading.classList.remove('show');
            } finally {
                btn.disabled = false;
            }
        }
        
        function showAIError(message) {
            const errorDiv = document.getElementById('aiError');
            errorDiv.innerHTML = message;
            errorDiv.classList.add('show');
        }
        
        function hideAIError() {
            document.getElementById('aiError').classList.remove('show');
        }
        
        // Save Gemini key to localStorage so they don't have to re-enter
        document.getElementById('geminiKey').addEventListener('change', function() {
            localStorage.setItem('geminiKey', this.value);
        });
        
        // Load saved Gemini key on page load
        window.addEventListener('load', function() {
            const savedKey = localStorage.getItem('geminiKey');
            if (savedKey) {
                document.getElementById('geminiKey').value = savedKey;
            }
        });
    </script>
</body>
</html>
